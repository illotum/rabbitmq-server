<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>RabbitMQ Management</title>
    <script src="js/ejs-1.0.min.js" type="text/javascript"></script>
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/jquery.flot-0.8.1.min.js" type="text/javascript"></script>
    <script src="js/jquery.flot-0.8.1.time.min.js" type="text/javascript"></script>
    <script src="js/sammy-0.7.6.min.js" type="text/javascript"></script>
    <script src="js/json2-2016.10.28.js" type="text/javascript"></script>
    <script src="js/base64.js" type="text/javascript"></script>
    <script src="js/global.js" type="text/javascript"></script>
    <script src="js/main.js" type="text/javascript"></script>
    <script src="js/prefs.js" type="text/javascript"></script>
    <script src="js/formatters.js" type="text/javascript"></script>
    <script src="js/charts.js" type="text/javascript"></script>
    <script src="js/oidc-oauth/oidc-client-ts.js" type="text/javascript"></script>
    <script src="js/oidc-oauth/helper.js"></script>

    <link href="css/main.css" rel="stylesheet" type="text/css"/>
    <link href="favicon.ico" rel="shortcut icon" type="image/x-icon"/>

    <script type="application/javascript">
      var authSettings = JSON.parse(sync_get('/auth'));

      var oauth = {
        "logged_in": false,
        "enable" : authSettings.oauth_enable,
        "client_id" : authSettings.oauth_client_id,
        "url" : authSettings.oauth_url,
        "readiness_url" : authSettings.oauth_url + "/.well-known/openid-configuration"
      }

      if (oauth.enable) {
        rabbit_port = window.location.port ? ":" +  window.location.port : ""
        rabbit_base_uri = window.location.protocol + "//" + window.location.hostname + rabbit_port

        oidcSettings = {
            //userStore: new WebStorageStateStore({ store: window.localStorage }),
            authority: authSettings.oauth_url,
            client_id: authSettings.oauth_client_id,
            client_secret: authSettings.oauth_client_secret,
            response_type: "code",
            scope: "openid profile rabbitmq.*",
            resource: authSettings.oauth_resource_id
        };
        initOidcClient(oidcSettings, rabbit_base_uri);

        isLoggedIn().then( status => {
          if (!status.loggedIn) {
            replace_content('outer', format('login_uaa', {}));
          }  else {
            start_app_login();
          }
        });

      }
    </script>

<!--[if lte IE 8]>
    <script src="js/excanvas.min.js" type="text/javascript"></script>
    <link href="css/evil.css" rel="stylesheet" type="text/css"/>
<![endif]-->
  </head>

  <body>
    <div id="outer"></div>
    <div id="debug"></div>
    <div id="scratch"></div>
  </body>
</html>
